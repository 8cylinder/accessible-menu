var AccessibleMenu=function(){"use strict";var e,t,n,r;function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}function l(e){var t="element";try{if(e instanceof HTMLElement)return!0;if("object"!==o(e))throw Error;for(var n in e)if(t=n,!(e[n]instanceof HTMLElement))throw Error}catch(e){throw new TypeError("".concat(t," must be an HTML Element."))}}function c(e){var t="element";try{if("string"!=typeof e){if("object"!==o(e))throw Error;for(var n in e){if(t=n,"string"!=typeof e[n])throw Error;document.querySelector(e[n])}}else document.querySelector(e);return!0}catch(e){throw new TypeError("".concat(t," must be a valid CSS selector."))}}function a(e){var t="element";try{if("boolean"==typeof e)return!0;if("object"!==o(e))throw Error;for(var n in e)if(t=n,"boolean"!=typeof e[n])throw Error}catch(e){throw new TypeError("".concat(t," must be a boolean."))}}function m(e){var t="element";try{if(e instanceof v)return!0;if("object"!==o(e))throw Error;for(var n in e)if(t=n,!(e[n]instanceof v))throw Error}catch(e){throw new TypeError("".concat(t," must be a Menu."))}}function h(e){!function(e){var t="event";try{if(e instanceof KeyboardEvent)return!0;if("object"!==o(e))throw Error;for(var n in e)if(t=n,!(e[n]instanceof KeyboardEvent))throw Error}catch(e){throw new TypeError("".concat(t," must be a KeyboardEvent."))}}(e);try{var t=e.key||e.keyCode,n={Enter:"Enter"===t||13===t,Space:" "===t||"Spacebar"===t||32===t,Escape:"Escape"===t||"Esc"===t||27===t,ArrowUp:"ArrowUp"===t||"Up"===t||38===t,ArrowRight:"ArrowRight"===t||"Right"===t||39===t,ArrowDown:"ArrowDown"===t||"Down"===t||40===t,ArrowLeft:"ArrowLeft"===t||"Left"===t||37===t,Home:"Home"===t||36===t,End:"End"===t||35===t,Character:!!t.match(/^[a-zA-Z]{1}$/),Tab:"Tab"===t||9===t};return Object.keys(n).find((function(e){return!0===n[e]}))}catch(e){return""}}function f(e){!function(e){var t="event";try{if(e instanceof Event)return!0;if("object"!==o(e))throw Error;for(var n in e)if(t=n,!(e[n]instanceof Event))throw Error}catch(e){throw new TypeError("".concat(t," must be an Event."))}}(e),e.preventDefault(),e.stopPropagation()}Array.from||(Array.from=(e=Object.prototype.toString,t=function(t){return"function"==typeof t||"[object Function]"===e.call(t)},n=Math.pow(2,53)-1,r=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),n)},function(e){var n=this,o=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var i,u=arguments.length>1?arguments[1]:void 0;if(void 0!==u){if(!t(u))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(i=arguments[2])}for(var s,l=r(o.length),c=t(n)?Object(new n(l)):new Array(l),a=0;a<l;)s=o[a],c[a]=u?void 0===i?u(s,a):u.call(i,s,a):s,a+=1;return c.length=l,c})),Array.includes||(Array.prototype.includes=function(e){return!!~this.indexOf(e)}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw TypeError("predicate must be a function");for(var r=arguments[1],o=0;o<n;){var i=t[o];if(e.call(r,i,o,t))return i;o++}},configurable:!0,writable:!0});var d=function(){function e(t){var n=t.menuToggleElement,r=t.parentElement,o=t.menu,u=t.openClass,s=void 0===u?"show":u,a=t.parentMenu,h=void 0===a?null:a;i(this,e),l({menuToggleElement:n,parentElement:r}),m(null!==h?{menu:o,parentMenu:h}:{menu:o}),c({openClass:s}),this.domElements={toggle:n,parent:r},this.elements={menu:o,parentMenu:h},this.openClass=s,this.show=!1,this.initialize()}return s(e,[{key:"initialize",value:function(){if(this.element.setAttribute("aria-haspopup","true"),this.element.setAttribute("aria-expanded","false"),this.element.setAttribute("role","button"),""===this.element.id||""===this.menu.element.id){var e=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,10),t="".concat(this.element.innerText.toLowerCase().replace(/[^a-zA-Z0-9\s]/g,"").replace(/\s/g,"-"),"-").concat(e);this.element.id=this.element.id||"".concat(t,"-menu-button"),this.menu.element.id=this.menu.element.id||"".concat(t,"-menu")}this.menu.element.setAttribute("aria-labelledby",this.element.id),this.element.setAttribute("aria-controls",this.menu.element.id),this.handleClick()}},{key:"expand",value:function(){this.element.setAttribute("aria-expanded","true"),this.parentElement.classList.add(this.openClass),this.menu.element.classList.add(this.openClass)}},{key:"open",value:function(e){this.isOpen=!0,this.expand(),this.closeSiblings(e),this.parentMenu&&(this.parentMenu.currentFocus="child"),this.menu.currentFocus="self",e instanceof MouseEvent||this.menu.focusFirstChild()}},{key:"preview",value:function(e){this.isOpen=!0,this.expand(),this.closeSiblings(e),this.parentMenu&&(this.parentMenu.currentFocus="self",e instanceof MouseEvent||this.parentMenu.focusCurrentChild()),this.menu.currentFocus="none"}},{key:"close",value:function(e){this.isOpen&&(this.isOpen=!1,this.element.setAttribute("aria-expanded","false"),this.parentElement.classList.remove(this.openClass),this.menu.element.classList.remove(this.openClass),e instanceof MouseEvent||this.menu.focusFirstChild(),this.closeChildren(e),this.menu.blur(e),this.parentMenu?(this.parentMenu.currentFocus="self",e instanceof MouseEvent||this.parentMenu.focusCurrentChild()):!this.menu.isTopLevel||e instanceof MouseEvent||this.menu.focusController())}},{key:"toggle",value:function(e){this.isOpen?this.close(e):this.open(e)}},{key:"closeSiblings",value:function(e){var t=this;try{this.parentMenu.menuToggles.forEach((function(n){n!==t&&n.close(e)}))}catch(e){}}},{key:"closeChildren",value:function(e){this.menu.menuToggles.forEach((function(t){return t.close(e)}))}},{key:"handleClick",value:function(){var e=this;this.element.addEventListener("click",(function(t){f(t),e.toggle(t)}))}},{key:"element",get:function(){return this.domElements.toggle}},{key:"parentElement",get:function(){return this.domElements.parent}},{key:"menu",get:function(){return this.elements.menu}},{key:"parentMenu",get:function(){return this.elements.parentMenu}},{key:"isOpen",get:function(){return this.show},set:function(e){a(e),this.show=e}}]),e}(),p=function(){function e(t){var n=t.menuItemElement,r=t.menuLinkElement,u=t.parentMenu,s=t.isSubmenuItem,c=void 0!==s&&s,h=t.childMenu,f=void 0===h?null:h,p=t.toggle,v=void 0===p?null:p;i(this,e),l({menuItemElement:n,menuLinkElement:r}),m(null!==f?{parentMenu:u,childMenu:f}:{parentMenu:u}),a({isSubmenuItem:c}),null!==v&&function(e){var t="element";try{if(e instanceof d)return!0;if("object"!==o(e)||e instanceof d)throw Error;for(var n in e)if(t=n,!(e[n]instanceof d))throw Error}catch(e){throw new TypeError("".concat(t," must be a MenuToggle."))}}({toggle:v}),this.domElements={menuItem:n,link:r},this.elements={parentMenu:u,childMenu:f,toggle:v},this.isController=c,this.initialize()}return s(e,[{key:"initialize",value:function(){this.element.setAttribute("role","none"),this.linkElement.setAttribute("role","menuitem"),this.linkElement.tabIndex=-1}},{key:"focus",value:function(){this.linkElement.focus(),this.parentMenu.isTopLevel&&(this.linkElement.tabIndex=0)}},{key:"blur",value:function(){this.linkElement.blur(),this.parentMenu.isTopLevel&&(this.linkElement.tabIndex=-1)}},{key:"element",get:function(){return this.domElements.menuItem}},{key:"linkElement",get:function(){return this.domElements.link}},{key:"parentMenu",get:function(){return this.elements.parentMenu}},{key:"childMenu",get:function(){return this.elements.childMenu}},{key:"toggle",get:function(){return this.elements.toggle}},{key:"isSubmenuItem",get:function(){return this.isController}}]),e}(),v=function(){function e(t){var n=t.menuElement,r=t.menuItemSelector,u=void 0===r?"li":r,s=t.menuLinkSelector,h=void 0===s?"a":s,f=t.submenuItemSelector,d=void 0===f?null:f,p=t.submenuToggleSelector,v=void 0===p?null:p,y=t.submenuSelector,E=void 0===y?null:y,b=t.openClass,g=void 0===b?"show":b,C=t.isTopLevel,M=void 0===C||C,k=t.controllerElement,w=void 0===k?null:k,I=t.containerElement,S=void 0===I?null:I,T=t.parentMenu,L=void 0===T?null:T,A=t.isHoverable,F=void 0!==A&&A,x=t.hoverDelay,j=void 0===x?250:x;i(this,e),l({menuElement:n}),c({menuItemSelector:u,menuLinkSelector:h,openClass:g}),a({isTopLevel:M,isHoverable:F}),function(e){var t="element";try{if("number"==typeof e)return!0;if("object"!==o(e))throw Error;for(var n in e)if(t=n,"number"!=typeof e[n])throw Error}catch(e){throw new TypeError("".concat(t," must be a number."))}}({hoverDelay:j}),function(e,t,n){null===e&&null===t&&null===n||c({submenuItemSelector:e,submenuToggleSelector:t,submenuSelector:n})}(d,v,E),function(e,t){null===e&&null===t||l({controllerElement:e,containerElement:t})}(w,S),null!==L&&m({parentMenu:L}),this.domElements={menu:n,controller:w,container:S,menuItems:Array.from(n.querySelectorAll(u)).filter((function(e){return e.parentElement===n})),submenuItems:Array.from(n.querySelectorAll(d)).filter((function(e){return e.parentElement===n}))},this.domSelectors={"menu-items":u,"menu-links":h,"submenu-items":d,"submenu-toggle":v,submenu:E},this.elements={menuItems:[],menuToggles:[],controller:null,parentMenu:L,rootMenu:M?this:null},this.focussedChild=0,this.focusState="none",this.openClass=g,this.root=M,this.hoverable=F,this.delay=j,this.initialize()}return s(e,[{key:"initialize",value:function(){if(this.element.setAttribute("role","menubar"),null===this.rootMenu&&this.findRootMenu(this),this.createMenuItems(),this.handleKeydown(),this.handleClick(),this.isHoverable&&this.handleHover(),this.isTopLevel&&(this.currentMenuItem.linkElement.tabIndex=0,this.handleFocus(),this.controllerElement&&this.containerElement)){var e=new d({menuToggleElement:this.controllerElement,parentElement:this.containerElement,menu:this,openClass:this.openClass});this.elements.controller=e}}},{key:"findRootMenu",value:function(e){if(e.isTopLevel)this.elements.rootMenu=e;else{if(null===e.parentMenu)throw new Error("Cannot find root menu.");this.findRootMenu(e.parentMenu)}}},{key:"createMenuItems",value:function(){var t=this;this.menuItemElements.forEach((function(n){var r;if(t.submenuItemElements.includes(n)){var o=n.querySelector(t.selector["submenu-toggle"]),i=new e({menuElement:n.querySelector(t.selector.submenu),menuItemSelector:t.selector["menu-items"],menuLinkSelector:t.selector["menu-links"],submenuItemSelector:t.selector["submenu-items"],submenuToggleSelector:t.selector["submenu-toggle"],submenuSelector:t.selector.submenu,openClass:t.openClass,isTopLevel:!1,parentMenu:t,isHoverable:t.isHoverable,hoverDelay:t.hoverDelay}),u=new d({menuToggleElement:o,parentElement:n,menu:i,openClass:t.openClass,parentMenu:t});t.elements.menuToggles.push(u),r=new p({menuItemElement:n,menuLinkElement:o,parentMenu:t,isSubmenuItem:!0,childMenu:i,toggle:u})}else{var s=n.querySelector(t.selector["menu-links"]);r=new p({menuItemElement:n,menuLinkElement:s,parentMenu:t})}t.elements.menuItems.push(r)}))}},{key:"handleFocus",value:function(){var e=this;this.menuItems.forEach((function(t){t.linkElement.addEventListener("focusin",(function(){"none"===e.currentFocus&&(e.currentFocus="self",e.focusCurrentChild())})),t.linkElement.addEventListener("focusout",(function(t){"none"===e.currentFocus&&(e.blur(t),e.closeChildren(t))}))}))}},{key:"handleKeydown",value:function(){var e=this;this.element.addEventListener("keydown",(function(t){var n=h(t),r=t.altKey,o=t.crtlKey,i=t.metaKey,u=r||o||i;if(e.isTopLevel){if("none"===e.currentFocus)"Space"!==n&&"Enter"!==n||(f(t),e.currentFocus="self",e.focusFirstChild());else if("self"===e.currentFocus)if("Space"===n||"Enter"===n)f(t),e.currentMenuItem.linkElement.click();else if("ArrowRight"===n){f(t);var s=e.currentMenuItem.isSubmenuItem&&e.currentMenuItem.toggle.isOpen;e.focusNextChild(),s&&(e.currentMenuItem.isSubmenuItem?e.currentMenuItem.toggle.preview(t):e.closeChildren(t))}else if("ArrowLeft"===n){f(t);var l=e.currentMenuItem.isSubmenuItem&&e.currentMenuItem.toggle.isOpen;e.focusPreviousChild(),l&&(e.currentMenuItem.isSubmenuItem?e.currentMenuItem.toggle.preview(t):e.closeChildren(t))}else"ArrowDown"===n?e.currentMenuItem.isSubmenuItem&&(f(t),e.currentMenuItem.toggle.open(t),e.currentMenuItem.childMenu.focusFirstChild()):"ArrowUp"===n?e.currentMenuItem.isSubmenuItem&&(f(t),e.currentMenuItem.toggle.open(t),e.currentMenuItem.childMenu.focusLastChild()):"Home"===n?(f(t),e.focusFirstChild()):"End"===n?(f(t),e.focusLastChild()):"Escape"===n&&null!==e.controller&&e.controller.close(t)}else"Space"===n||"Enter"===n?(f(t),e.currentMenuItem.linkElement.click()):"Escape"===n?(f(t),e.rootMenu.closeChildren(t),e.rootMenu.focusCurrentChild()):"ArrowRight"===n?e.currentMenuItem.isSubmenuItem?(f(t),e.currentMenuItem.toggle.open(t)):(f(t),e.rootMenu.closeChildren(t),e.rootMenu.focusNextChild(),e.rootMenu.currentMenuItem.isSubmenuItem&&e.rootMenu.currentMenuItem.toggle.preview(t)):"ArrowLeft"===n?e.parentMenu.currentMenuItem.isSubmenuItem&&(f(t),e.parentMenu.currentMenuItem.toggle.close(t),e.parentMenu===e.rootMenu&&(e.rootMenu.closeChildren(t),e.rootMenu.focusPreviousChild(),e.rootMenu.currentMenuItem.isSubmenuItem&&e.rootMenu.currentMenuItem.toggle.preview(t))):"ArrowDown"===n?(f(t),e.focusNextChild()):"ArrowUp"===n?(f(t),e.focusPreviousChild()):"Home"===n?(f(t),e.focusFirstChild()):"End"===n&&(f(t),e.focusLastChild());"Character"!==n||u||(f(t),e.focusNextChildWithCharacter(t.key)),"none"!==e.currentFocus&&"Tab"===n&&(e.rootMenu.blur(t),e.rootMenu.closeChildren(t))}))}},{key:"handleClick",value:function(){var e=this;document.addEventListener("click",(function(t){e.element.contains(t.target)||e.element===t.target||(e.blur(t),e.closeChildren(t),e.controller&&e.controller.close(t))})),this.menuItems.forEach((function(t){t.linkElement.addEventListener("click",(function(){e.focussedChild=e.menuItems.indexOf(t)}))}))}},{key:"handleHover",value:function(){var e=this;this.menuItems.forEach((function(t){t.isSubmenuItem&&(t.element.addEventListener("mouseenter",(function(e){t.toggle.open(e)})),t.element.addEventListener("mouseleave",(function(n){setTimeout((function(){t.toggle.close(n)}),e.hoverDelay)})))}))}},{key:"focus",value:function(){this.currentFocus="self",this.element.focus()}},{key:"blur",value:function(e){this.currentFocus="none",this.element.blur(),this.isTopLevel&&this.controller&&this.controller.close(e)}},{key:"focusFirstChild",value:function(){this.blurCurrentChild(),this.focussedChild=0,this.focusCurrentChild()}},{key:"focusLastChild",value:function(){this.blurCurrentChild(),this.focussedChild=this.menuItems.length-1,this.focusCurrentChild()}},{key:"focusNextChild",value:function(){this.focussedChild===this.menuItems.length-1?this.focusFirstChild():(this.blurCurrentChild(),this.focussedChild=this.focussedChild+1,this.focusCurrentChild())}},{key:"focusPreviousChild",value:function(){0===this.focussedChild?this.focusLastChild():(this.blurCurrentChild(),this.focussedChild=this.focussedChild-1,this.focusCurrentChild())}},{key:"focusCurrentChild",value:function(){-1!==this.focussedChild&&this.currentMenuItem.focus()}},{key:"blurCurrentChild",value:function(){-1!==this.focussedChild&&this.currentMenuItem.blur()}},{key:"focusNextChildWithCharacter",value:function(e){for(var t=e.toLowerCase(),n=this.focussedChild+1,r=!1;!r&&n<this.menuItems.length;){this.menuItems[n].element.innerText.toLowerCase().startsWith(t)&&(r=!0,this.focussedChild=n,this.focusCurrentChild()),n++}}},{key:"focusController",value:function(){this.controllerElement&&(this.controllerElement.focus(),this.currentFocus="none")}},{key:"focusContainer",value:function(){this.containerElement&&(this.containerElement.focus(),this.currentFocus="none")}},{key:"closeChildren",value:function(e){this.menuToggles.forEach((function(t){return t.close(e)}))}},{key:"element",get:function(){return this.domElements.menu}},{key:"controllerElement",get:function(){return this.domElements.controller}},{key:"containerElement",get:function(){return this.domElements.container}},{key:"menuItemElements",get:function(){return this.domElements.menuItems}},{key:"submenuItemElements",get:function(){return this.domElements.submenuItems}},{key:"menuItems",get:function(){return this.elements.menuItems}},{key:"menuToggles",get:function(){return this.elements.menuToggles}},{key:"parentMenu",get:function(){return this.elements.parentMenu}},{key:"rootMenu",get:function(){return this.elements.rootMenu}},{key:"controller",get:function(){return this.elements.controller}},{key:"selector",get:function(){return this.domSelectors}},{key:"currentFocus",get:function(){return this.focusState},set:function(e){!function(e){var t=["self","child","none"],n="element";try{if("string"==typeof e){if(t.includes(e))return!0;throw Error}if("object"!==o(e))throw Error;for(var r in e)if(n=r,!t.includes(e[r]))throw Error}catch(e){throw new Error("".concat(n," must be on of the following: ").concat(t.join(", ")))}}({value:e}),this.focusState=e}},{key:"openClass",get:function(){return this.submenuOpenClass},set:function(e){!function(e){var t="element";try{if("string"==typeof e)return!0;if("object"!==o(e))throw Error;for(var n in e)if(t=n,"string"!=typeof e[n])throw Error}catch(e){throw new TypeError("".concat(t," must be a string."))}}({value:e}),this.submenuOpenClass=e}},{key:"currentMenuItem",get:function(){return this.menuItems[this.focussedChild]}},{key:"isTopLevel",get:function(){return this.root}},{key:"isHoverable",get:function(){return this.hoverable}},{key:"hoverDelay",get:function(){return this.delay}}]),e}();return v}();
